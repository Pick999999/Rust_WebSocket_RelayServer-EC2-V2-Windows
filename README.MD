# üöÄ Deriv Trading Relay Server (Rust)

## 1. System Architecture

### Overview

‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô **Relay Server** ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Browser (Frontend) ‡πÅ‡∏•‡∏∞ Deriv WebSocket API

```
[ Browser / Dashboard ]
          ‚îÇ
          ‚îÇ WebSocket (/ws)
          ‚ñº
[ Rust Relay Server (Axum) ]
          ‚îÇ
          ‚îÇ WebSocket (tokio-tungstenite)
          ‚ñº
[ Deriv WebSocket API ]
```

---

## 2. Component Breakdown

### 2.1 Axum WebSocket Server

‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:

* ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å Browser
* ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Real-time ‡∏ú‡πà‡∏≤‡∏ô Broadcast Channel
* ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö

Endpoint:

* `GET /ws`

---

### 2.2 Broadcast System

‡πÉ‡∏ä‡πâ `tokio::sync::broadcast`

```
Deriv Data
   ‚îÇ
   ‚ñº
broadcast::Sender
   ‚îÇ
   ‚îú‚îÄ‚îÄ Browser #1
   ‚îú‚îÄ‚îÄ Browser #2
   ‚îî‚îÄ‚îÄ Browser #N
```

---

### 2.3 Deriv Connector Task

‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô background task ‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å WebSocket Server

‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:

* ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Deriv API
* Subscribe Tick / Candle
* ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Indicator
* ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Trend
* ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ Trade

---

## 3. Data Flow

### 3.1 Connection Flow

```
Browser
  ‚îÇ START_DERIV
  ‚ñº
Relay Server
  ‚îÇ spawn task
  ‚ñº
Deriv Connector
```

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£ START ‡πÉ‡∏´‡∏°‡πà:

* ‡∏õ‡∏¥‡∏î connection ‡πÄ‡∏Å‡πà‡∏≤
* unsubscribe ‡∏ó‡∏∏‡∏Å subscription

---

### 3.2 Market Data Flow

```
Deriv Tick / Candle
        ‚îÇ
        ‚ñº
parse_flexible()
        ‚îÇ
        ‚îú‚îÄ Candle
        ‚îú‚îÄ EMA Calculation
        ‚îî‚îÄ EMA Analysis
        ‚îÇ
        ‚ñº
Broadcast ‚Üí Browser
```

---

## 4. Indicator & Analysis Engine

### 4.1 Candle Buffer

* ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 200 ‡πÅ‡∏ó‡πà‡∏á
* Normalize ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö 1 ‡∏ô‡∏≤‡∏ó‡∏µ

### 4.2 Supported Indicators

* EMA
* SMA
* WMA
* HMA
* EHMA

### 4.3 EMA Analysis

‡πÉ‡∏ä‡πâ `analyze_ema()` ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:

* EMA Slope
* EMA Turn
* EMA Cross
* Position (Above / Below)
* Distance Metrics

‡∏™‡πà‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

---

## 5. Trading Engine

### 5.1 Trade Trigger

* ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà 0‚Äì2 ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ô‡∏≤‡∏ó‡∏µ
* ‡∏à‡∏≥‡∏Å‡∏±‡∏î 1 trade ‡∏ï‡πà‡∏≠ 1 ‡∏ô‡∏≤‡∏ó‡∏µ

### 5.2 Trade Mode

| Mode | Behavior                |
| ---- | ----------------------- |
| idle | ‡πÑ‡∏°‡πà‡πÄ‡∏ó‡∏£‡∏î                 |
| call | CALL ‡∏ó‡∏∏‡∏Å‡∏ô‡∏≤‡∏ó‡∏µ            |
| put  | PUT ‡∏ó‡∏∏‡∏Å‡∏ô‡∏≤‡∏ó‡∏µ             |
| auto | ‡πÉ‡∏ä‡πâ Action ‡∏à‡∏≤‡∏Å Analysis |

---

### 5.3 Money Management

#### Fix Mode

* ‡πÉ‡∏ä‡πâ stake ‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏•‡∏≠‡∏î

#### Martingale Mode

* ‡πÄ‡∏û‡∏¥‡πà‡∏° stake ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏û‡πâ
* reset ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏ô‡∏∞

---

## 6. Command Protocol (Browser ‚Üí Server)

| Command       | Description                   |
| ------------- | ----------------------------- |
| START_DERIV   | ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Deriv          |
| UPDATE_MODE   | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô trade mode            |
| UPDATE_PARAMS | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô duration / money mode |
| SELL          | ‡∏õ‡∏¥‡∏î contract ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ            |

---

## 7. Message Protocol (Server ‚Üí Browser)

| Type          | Payload           |
| ------------- | ----------------- |
| candle        | OHLC Data         |
| ema_data      | EMA Lines         |
| analysis_data | Trend Analysis    |
| balance       | Account Balance   |
| trade_opened  | Trade Open Info   |
| trade_update  | Live Trade Status |
| trade_result  | Final Result      |

---

## 8. Fault Tolerance

* Detect Deriv API Error
* Auto stop connection on error
* Safe unsubscribe on reconnect

---

## 9. Design Goals

* Low Latency
* Real-time Streaming
* Decoupled Frontend / Backend
* Extensible Indicator Engine

---

## 10. Future Extension

* Multi-asset support
* AI / ML decision engine
* Backtesting module
* Persistent trade history

---

‚úÖ **Production-ready architecture for real-time trading systems**
"# Rust_Websocket_WIndows10" 
"# Rust_WebSocket_RelayServer-EC2-V2-Windows" 
